# 关键字—`register`

## 1. C语言存储期和链接

### 1.1 存储期

即生存期，有四种：

+ 自动存储期：当一个对象在其所在的块中被声明时，会为其分配存储空间；而退出该块时，会释放其存储空间
+ 静态存储期：对象的存储期贯穿整个程序的执行过程
+ 线程存储期：对象的存储期贯穿整个线程的执行过程*（C11起）*
+ 分配存储期：使用动态内存分配函数来分配和释放存储空间

### 1.2 链接

即可见性，有三种：

+ 无链接：标识符只能在其所在的作用域中被引用
+ 内部链接：标识符可以在当前的翻译单元的所有作用域中被引用
+ 外部链接：标识符可以在任何其他翻译单元的所有作用域中被引用

## 2. C语言存储类别说明符

|          关键字          | 存储期 |             链接             |
| :----------------------: | :----: | :--------------------------: |
|          `auto`          |  自动  |            无链接            |
|         `extern`         |  静态  |           外部链接           |
|        `register`        |  自动  |            无链接            |
|         `static`         |  静态  | 内部链接（块作用域下无链接） |
| `_Thread_local`*(C11起)* |  线程  |                              |

## 3. `register`的作用

`register`关键字建议编译器将变量存储在CPU寄存器以提高效率，但实际是否采纳这一建议由编译器自行决定

## 4. C语言使用`register`注意事项

+ 不能对寄存器变量进行取地址运算

```C
register int i = 0;
int *p = &i; // error
```

+ `register`关键字可以修饰指针变量

```C
int i = 0;
register int *p = &i; // OK
```

+ 关键字 `register` 只能在局部作用域内和函数参数列表中使用，不能在全局作用域中使用

```C
register int i = 0; //error

int main()
{
    return 0;
}
```

```C
int func(register int number) // OK
{
    return number;
}
```

+ `register`是一个存储类别说明符，每个变量只能拥有一个存储类别说明符。因此，`register`关键字不能与`static`一同使用

```C
register static int i = 0; // error
```

+ C程序虽然可以声明不限数量的寄存器变量，但编译器可能并不会把所有这些变量都存入寄存器中

## 5. C++`register`

+ **从C++17开始，虽然`register`关键词被保留，但在C++中不再使用**

+ 在C++17之前，使用`register`关键字声明的对象与未带任何存储类说明符的变量在语义上没有区别（相当于C中的`auto`），并且可以用来提示优化器将该变量的值存储到CPU寄存器中

```C++
// test.cpp

register int i = 0; // error

int main()
{
    register int j = 0;
    int *p = &j; // OK
}
```
